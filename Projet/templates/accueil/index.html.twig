{% extends 'base.html.twig' %}

{% block title %}Œuvres{% endblock %}

{% block body %}
    {% if app.user is not null %} {# Vérifie si l'utilisateur est connecté #}
        <!-- Barre de recherche -->
        <form id="searchForm" class="mb-4 p-4 rounded bg-white shadow-sm">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <input type="text" class="form-control" name="keyword" placeholder="Rechercher par mots clés...">
                </div>
                <div class="col-md-4 mb-3">
                    <input type="text" class="form-control" name="titre" placeholder="Rechercher par titre...">
                </div>
                <div class="col-md-4 mb-3">
                    <input type="text" class="form-control" name="artiste" placeholder="Rechercher par artiste...">
                </div>
                <div class="col-md-4 mb-3">
                    <input type="number" class="form-control" name="year" placeholder="Rechercher par année...">
                </div>
                <div class="col-md-4 mb-3">
                    <label for="type">Type</label>
                    <select name="type" class="form-control" id="type">
                        <option value="">Tous les types</option>
                        <option value="peinture">Peinture</option>
                        <option value="sculpture">Sculpture</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="technique">Technique</label>
                    <select name="technique" class="form-control" id="technique">
                        <option value="">Toutes les techniques</option>
                        <option value="huile">Huile</option>
                        <option value="aquarelle">Aquarelle</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <input type="text" class="form-control" name="lieu_creation" placeholder="Rechercher par lieu de création...">
                </div>
                <div class="col-md-4 mb-3">
                    <input type="text" class="form-control" name="dimensions" placeholder="Rechercher par dimensions...">
                </div>
                <div class="col-md-4 mb-3">
                    <input type="text" class="form-control" name="mouvement" placeholder="Rechercher par mouvement...">
                </div>
                <div class="col-md-4 mb-3">
                    <input type="text" class="form-control" name="collection" placeholder="Rechercher par collection...">
                </div>
            </div>
            <div class="text-center">
                <button type="submit" class="btn btn-primary">Rechercher</button>
            </div>
        </form>
    {% else %}
        <p class="text-center">Veuillez vous connecter pour accéder à la barre de recherche.</p>
    {% endif %}

    <!-- Affichage des œuvres -->
    <h2 class="text-center">Œuvres</h2>
    <div id="oeuvreList" class="row">
        {% for oeuvre in oeuvres %}
            <div class="col-md-4 mb-4"> <!-- 3 cartes par rangée -->
                <div class="card">
                    <img src="/uploads/images/{{ oeuvre.image }}" class="card-img-top" alt="{{ oeuvre.titre }}">
                    <div class="card-body">
                        <h5 class="card-title">{{ oeuvre.titre }}</h5>
                        <p class="card-text"><strong>Artiste :</strong> {{ oeuvre.artiste }}</p>
                        <p class="card-text"><strong>Date :</strong> {{ oeuvre.date ? oeuvre.date|date('d/m/Y') : 'Inconnue' }}</p>
                        <p class="card-text"><strong>Type :</strong> {{ oeuvre.type }}</p>
                        <p class="card-text"><strong>Technique :</strong> {{ oeuvre.technique }}</p>
                        <p class="card-text"><strong>Lieu :</strong> {{ oeuvre.lieuCreation }}</p>
                        <p class="card-text">{{ oeuvre.description }}</p>
                    </div>
                </div>
            </div>
        {% else %}
            <p class="text-center">Aucune œuvre trouvée.</p>
        {% endfor %}
    </div>

    <script>
    $(document).ready(function() {
        $('#searchForm').on('submit', function(event) {
            event.preventDefault();
            $.ajax({
                url: '{{ path('oeuvre_index') }}',
                type: 'GET',
                data: $(this).serialize(),
                success: function(data) {
                    $('#oeuvreList').empty();
                    if (data.length === 0) {
                        $('#oeuvreList').append('<p class="text-center">Aucune œuvre trouvée.</p>');
                    } else {
                        $.each(data, function(index, oeuvre) {
                            $('#oeuvreList').append(`
                                <div class="col-md-4 mb-4">
                                    <div class="card">
                                        <img src="/uploads/images/${oeuvre.image}" class="card-img-top" alt="${oeuvre.titre}">
                                        <div class="card-body">
                                            <h5 class="card-title">${oeuvre.titre}</h5>
                                            <p class="card-text"><strong>Artiste :</strong> ${oeuvre.artiste}</p>
                                            <p class="card-text"><strong>Date :</strong> ${oeuvre.date ? new Date(oeuvre.date).toLocaleDateString() : 'Inconnue'}</p>
                                            <p class="card-text"><strong>Type :</strong> ${oeuvre.type}</p>
                                            <p class="card-text"><strong>Technique :</strong> ${oeuvre.technique}</p>
                                            <p class="card-text">${oeuvre.description}</p>
                                        </div>
                                    </div>
                                </div>
                            `);
                        });
                    }
                },
                error: function() {
                    alert('Erreur lors de la recherche.');
                }
            });
        });
    });
    </script>

{% endblock %}
